---
const showHomeLink = Astro.props?.showHome ?? true;
---

<header class="bg-[#305048] text-white sticky top-0 z-50 shadow-md">
    <div class="container mx-auto px-6 py-4 flex justify-between items-center">
        <a href="/" class="text-2xl font-bold tracking-wide">
            PALMA <span class="text-[#FF8057]">CLEANING</span>
        </a>
        <nav class="hidden lg:flex items-center space-x-8 text-sm">
            {showHomeLink && <a href="/" class="hover:text-[#FF8057] transition duration-300">Home</a>}
            
            <!-- Services Dropdown -->
            <div class="relative">
                <button class="desktop-dropdown-toggle hover:text-[#FF8057] transition duration-300 flex items-center gap-1 py-2 bg-transparent border-0 text-white cursor-pointer" data-target="desktop-services">
                    Services
                    <i class="fa-solid fa-chevron-down text-xs opacity-70 transition-transform"></i>
                </button>
                <div id="desktop-services" class="absolute top-full left-0 pt-2 w-64 opacity-0 invisible transition-all duration-300 pointer-events-none hidden">
                    <div class="bg-white rounded-lg shadow-xl border border-gray-100 py-2">
                        <a href="/standard-cleaning" class="block px-4 py-2 text-[#305048] hover:bg-[#F4F7F6] hover:text-[#FF8057] transition">Standard Cleaning</a>
                        <a href="/deep-cleaning" class="block px-4 py-2 text-[#305048] hover:bg-[#F4F7F6] hover:text-[#FF8057] transition">Deep Cleaning</a>
                        <a href="/move-in-out-cleaning" class="block px-4 py-2 text-[#305048] hover:bg-[#F4F7F6] hover:text-[#FF8057] transition">Move-In / Move-Out</a>
                        <a href="/post-construction-cleaning" class="block px-4 py-2 text-[#305048] hover:bg-[#F4F7F6] hover:text-[#FF8057] transition">Post-Construction</a>
                        <a href="/commercial-cleaning" class="block px-4 py-2 text-[#305048] hover:bg-[#F4F7F6] hover:text-[#FF8057] transition">Commercial / Office</a>
                        <div class="border-t border-gray-200 my-1"></div>
                        <a href="/services" class="block px-4 py-2 text-[#305048] hover:bg-[#F4F7F6] hover:text-[#FF8057] transition font-semibold text-[#FF8057]">View All Services</a>
            </div>
        </div>
            </div>
            
            <a href="/about" class="hover:text-[#FF8057] transition duration-300">About</a>
            
            <!-- Locations Dropdown -->
            <div class="relative">
                <button class="desktop-dropdown-toggle hover:text-[#FF8057] transition duration-300 flex items-center gap-1 py-2 bg-transparent border-0 text-white cursor-pointer" data-target="desktop-locations">
                    Locations
                    <i class="fa-solid fa-chevron-down text-xs opacity-70 transition-transform"></i>
                </button>
                <div id="desktop-locations" class="absolute top-full left-0 pt-2 w-64 opacity-0 invisible transition-all duration-300 pointer-events-none hidden">
                    <div class="bg-white rounded-lg shadow-xl border border-gray-100 py-2">
                        <a href="/ocala" class="block px-4 py-2 text-[#305048] hover:bg-[#F4F7F6] hover:text-[#FF8057] transition">Ocala & Marion County</a>
                        <a href="/the-villages" class="block px-4 py-2 text-[#305048] hover:bg-[#F4F7F6] hover:text-[#FF8057] transition">The Villages</a>
                        <a href="/stone-creek" class="block px-4 py-2 text-[#305048] hover:bg-[#F4F7F6] hover:text-[#FF8057] transition">Stone Creek</a>
                        <a href="/oak-run" class="block px-4 py-2 text-[#305048] hover:bg-[#F4F7F6] hover:text-[#FF8057] transition">Oak Run</a>
                        <a href="/golden-hills" class="block px-4 py-2 text-[#305048] hover:bg-[#F4F7F6] hover:text-[#FF8057] transition">Golden Hills</a>
                        <a href="/belleview" class="block px-4 py-2 text-[#305048] hover:bg-[#F4F7F6] hover:text-[#FF8057] transition">Belleview</a>
                        <a href="/wec-area" class="block px-4 py-2 text-[#305048] hover:bg-[#F4F7F6] hover:text-[#FF8057] transition">WEC Area</a>
                        <a href="/dunnellon" class="block px-4 py-2 text-[#305048] hover:bg-[#F4F7F6] hover:text-[#FF8057] transition">Dunnellon</a>
                        <div class="border-t border-gray-200 my-1"></div>
                        <a href="/service-areas" class="block px-4 py-2 text-[#305048] hover:bg-[#F4F7F6] hover:text-[#FF8057] transition font-semibold text-[#FF8057]">View All Locations</a>
        </div>
        </div>
        </div>
        
            <a href="/blog" class="hover:text-[#FF8057] transition duration-300">Blog</a>
            <a href="/contact" class="hover:text-[#FF8057] transition duration-300">Contact</a>
        </nav>
        <div class="flex items-center space-x-6">
            <a href="tel:3527644747" class="text-xs font-semibold hidden md:block tracking-wide">(352) 764-4747</a>
            <a href="/book-now" class="bg-[#FF8057] text-[#305048] font-bold py-3 px-6 rounded-md hover:bg-[#ff996f] transition duration-300 text-sm uppercase">Book Now</a>
            <button id="mobile-menu-button" class="lg:hidden text-2xl" aria-label="Toggle navigation">
                <i class="fa-solid fa-bars"></i>
            </button>
        </div>
    </div>
    <div id="mobile-menu" class="lg:hidden hidden border-t border-white/10 bg-[#305048]/95">
        <nav class="px-6 py-4 space-y-3 text-sm">
            {showHomeLink && <a href="/" class="block text-white/90 hover:text-[#FF8057] transition">Home</a>}
            
            <!-- Mobile Services Dropdown -->
            <div>
                <button class="mobile-dropdown-toggle w-full flex items-center justify-between text-white/90 hover:text-[#FF8057] transition" data-target="mobile-services">
                    Services <i class="fa-solid fa-chevron-down text-xs"></i>
                </button>
                <div id="mobile-services" class="hidden pl-4 pt-2 space-y-2 border-l-2 border-white/20 ml-2 mt-2">
                    <a href="/standard-cleaning" class="block text-white/70 hover:text-[#FF8057] transition">Standard Cleaning</a>
                    <a href="/deep-cleaning" class="block text-white/70 hover:text-[#FF8057] transition">Deep Cleaning</a>
                    <a href="/move-in-out-cleaning" class="block text-white/70 hover:text-[#FF8057] transition">Move-In / Move-Out</a>
                    <a href="/post-construction-cleaning" class="block text-white/70 hover:text-[#FF8057] transition">Post-Construction</a>
                    <a href="/commercial-cleaning" class="block text-white/70 hover:text-[#FF8057] transition">Commercial / Office</a>
                    <a href="/services" class="block text-[#FF8057] font-semibold mt-2">View All Services</a>
                </div>
            </div>
            
            <a href="/about" class="block text-white/90 hover:text-[#FF8057] transition">About</a>
            
            <!-- Mobile Locations Dropdown -->
            <div>
                <button class="mobile-dropdown-toggle w-full flex items-center justify-between text-white/90 hover:text-[#FF8057] transition" data-target="mobile-locations">
                    Locations <i class="fa-solid fa-chevron-down text-xs"></i>
                </button>
                <div id="mobile-locations" class="hidden pl-4 pt-2 space-y-2 border-l-2 border-white/20 ml-2 mt-2">
                    <a href="/ocala" class="block text-white/70 hover:text-[#FF8057] transition">Ocala & Marion County</a>
                    <a href="/the-villages" class="block text-white/70 hover:text-[#FF8057] transition">The Villages</a>
                    <a href="/stone-creek" class="block text-white/70 hover:text-[#FF8057] transition">Stone Creek</a>
                    <a href="/oak-run" class="block text-white/70 hover:text-[#FF8057] transition">Oak Run</a>
                    <a href="/golden-hills" class="block text-white/70 hover:text-[#FF8057] transition">Golden Hills</a>
                    <a href="/belleview" class="block text-white/70 hover:text-[#FF8057] transition">Belleview</a>
                    <a href="/wec-area" class="block text-white/70 hover:text-[#FF8057] transition">WEC Area</a>
                    <a href="/dunnellon" class="block text-white/70 hover:text-[#FF8057] transition">Dunnellon</a>
                    <a href="/service-areas" class="block text-[#FF8057] font-semibold mt-2">View All Locations</a>
                </div>
            </div>
            
            <a href="/blog" class="block text-white/90 hover:text-[#FF8057] transition">Blog</a>
            <a href="/contact" class="block text-white/90 hover:text-[#FF8057] transition">Contact</a>
            <a href="/book-now" class="block text-[#FF8057] font-semibold">Book Now</a>
        </nav>
    </div>
</header>

<script is:inline>
    (function() {
        const ensureLink = (href) => {
            if (!document.querySelector(`link[href="${href}"]`)) {
                const link = document.createElement('link');
                link.rel = 'stylesheet';
                link.href = href;
                document.head.appendChild(link);
            }
        };
        ensureLink('https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap');
        ensureLink('/home-tailwind.css');

        if (!window.FontAwesomeConfig) {
            window.FontAwesomeConfig = { autoReplaceSvg: 'nest' };
        }
        if (!document.querySelector('script[data-fa-loaded="true"]')) {
            const faScript = document.createElement('script');
            faScript.src = 'https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js';
            faScript.crossOrigin = 'anonymous';
            faScript.referrerPolicy = 'no-referrer';
            faScript.dataset.faLoaded = 'true';
            document.head.appendChild(faScript);
        }

        const styleId = 'palma-global-style';
        if (!document.getElementById(styleId)) {
            const style = document.createElement('style');
            style.id = styleId;
            style.textContent = '.font-poppins{font-family:"Poppins",sans-serif;}::-webkit-scrollbar{display:none;}';
            document.head.appendChild(style);
        }

        const mobileMenuButton = document.getElementById('mobile-menu-button');
        const mobileMenu = document.getElementById('mobile-menu');
        if (mobileMenuButton && mobileMenu) {
            mobileMenuButton.addEventListener('click', () => {
                mobileMenu.classList.toggle('hidden');
            });
        }

        // Close dropdown when clicking outside or on a link
        document.addEventListener('click', (e) => {
            // Check if click is on a dropdown toggle button
            const clickedToggle = e.target.closest('.desktop-dropdown-toggle');
            const clickedMobileToggle = e.target.closest('.mobile-dropdown-toggle');
            
            // Check if click is inside a dropdown menu
            const clickedInsideDropdown = e.target.closest('[id^="desktop-"]') && !e.target.closest('a');
            const clickedInsideMobile = e.target.closest('[id^="mobile-"]') && !e.target.closest('a');
            
            // If clicking on a toggle, let the toggle handler manage it
            if (clickedToggle || clickedMobileToggle) {
                return;
            }
            
            // If clicking on a link inside dropdown, close after navigation
            if (e.target.closest('[id^="desktop-"] a') || e.target.closest('[id^="mobile-"] a')) {
                // Close all desktop dropdowns
                document.querySelectorAll('[id^="desktop-"]').forEach(menu => {
                    menu.classList.add('hidden', 'opacity-0', 'invisible', 'pointer-events-none');
                    menu.classList.remove('opacity-100', 'visible', 'pointer-events-auto');
                });
                document.querySelectorAll('.desktop-dropdown-toggle i').forEach(chevron => {
                    chevron.classList.remove('rotate-180', 'opacity-100');
                    chevron.classList.add('opacity-70');
                });
                // Close all mobile dropdowns
                document.querySelectorAll('[id^="mobile-"]').forEach(menu => {
                    menu.classList.add('hidden');
                });
                document.querySelectorAll('.mobile-dropdown-toggle i').forEach(chevron => {
                    chevron.classList.remove('rotate-180');
                });
                return;
            }
            
            // If clicking outside any dropdown, close all
            if (!clickedInsideDropdown && !clickedInsideMobile && !clickedToggle && !clickedMobileToggle) {
                // Close all desktop dropdowns
                document.querySelectorAll('[id^="desktop-"]').forEach(menu => {
                    menu.classList.add('hidden', 'opacity-0', 'invisible', 'pointer-events-none');
                    menu.classList.remove('opacity-100', 'visible', 'pointer-events-auto');
                });
                document.querySelectorAll('.desktop-dropdown-toggle i').forEach(chevron => {
                    chevron.classList.remove('rotate-180', 'opacity-100');
                    chevron.classList.add('opacity-70');
                });
                // Close all mobile dropdowns (except main menu)
                document.querySelectorAll('[id^="mobile-"]').forEach(menu => {
                    if (menu.id !== 'mobile-menu') {
                        menu.classList.add('hidden');
                    }
                });
                document.querySelectorAll('.mobile-dropdown-toggle i').forEach(chevron => {
                    chevron.classList.remove('rotate-180');
                });
            }
        });

        // Desktop dropdown toggles
        document.querySelectorAll('.desktop-dropdown-toggle').forEach(button => {
            button.addEventListener('click', (e) => {
                e.preventDefault();
                e.stopPropagation();
                const targetId = button.getAttribute('data-target');
                const targetMenu = document.getElementById(targetId);
                const chevron = button.querySelector('i');
                
                if (!targetMenu) return;
                
                // Check if current dropdown is open (not hidden and visible)
                const isCurrentlyOpen = !targetMenu.classList.contains('hidden') && 
                                       targetMenu.classList.contains('opacity-100');
                
                // Close all desktop dropdowns first
                document.querySelectorAll('[id^="desktop-"]').forEach(menu => {
                    menu.classList.add('hidden', 'opacity-0', 'invisible', 'pointer-events-none');
                    menu.classList.remove('opacity-100', 'visible', 'pointer-events-auto');
                });
                document.querySelectorAll('.desktop-dropdown-toggle i').forEach(ch => {
                    ch.classList.remove('rotate-180', 'opacity-100');
                    ch.classList.add('opacity-70');
                });
                
                // If it was closed, open it now (toggle behavior)
                if (!isCurrentlyOpen) {
                    targetMenu.classList.remove('hidden', 'opacity-0', 'invisible', 'pointer-events-none');
                    targetMenu.classList.add('opacity-100', 'visible', 'pointer-events-auto');
                    if (chevron) {
                        chevron.classList.add('rotate-180', 'opacity-100');
                        chevron.classList.remove('opacity-70');
                    }
                }
            });
        });

        // Mobile dropdown toggles
        document.querySelectorAll('.mobile-dropdown-toggle').forEach(button => {
            button.addEventListener('click', (e) => {
                e.preventDefault();
                e.stopPropagation();
                const targetId = button.getAttribute('data-target');
                const targetMenu = document.getElementById(targetId);
                const chevron = button.querySelector('i');
                
                // Close all other mobile dropdowns
                document.querySelectorAll('[id^="mobile-"]').forEach(menu => {
                    if (menu.id !== targetId) {
                        menu.classList.add('hidden');
                    }
                });
                document.querySelectorAll('.mobile-dropdown-toggle i').forEach(ch => {
                    if (ch !== chevron) {
                        ch.classList.remove('rotate-180');
                    }
                });
                
                if (targetMenu) {
                    targetMenu.classList.toggle('hidden');
                    if (chevron) {
                        chevron.classList.toggle('rotate-180');
                    }
                }
            });
        });
    })();
</script>